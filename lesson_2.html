<html>
  <head>
    <meta charset="utf-8" /> 
    <title> Lesson 2: Flat Shading </title>
    <script src="js/bitmap.js"></script>
    <script src="js/rasterFlatTriangleBarycentric.js"></script>
    <script src="js/model.js"></script>
    <style>
      body,html {
        background-color: #000;
      }
      #viewport-container{
      }
      #viewport-container canvas {
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <div id="viewport-container">
    </div>
    <script>
      var kWidth = 512;
      var kHeight = 512;
      var $viewport = document.getElementById('viewport-container');
      var framebuffer = new Bitmap( kWidth, kHeight, $viewport );
      var model = new Model();

      framebuffer.clear();
      framebuffer.flush();

      var r = new XMLHttpRequest();
      r.open("GET", "/assets/bunny/bunny.obj", true);
      r.onreadystatechange = function () {
        if (r.readyState == 4 && r.status < 400) {
          console.log('Got model!');
          model.loadFromOBJString(r.responseText);
          var triBuffer = model.toTriArray();

          framebuffer.clear(); 
          for (var i = 0; i < triBuffer.length/9; i++ ){
            var ax = (triBuffer[9*i + 0]+1) * kWidth/2;
            var ay = (triBuffer[9*i + 1]+1) * kHeight/2;
            var az = (triBuffer[9*i + 2]+1) * kHeight/2;
            var bx = (triBuffer[9*i + 3]+1)* kWidth/2;
            var by = (triBuffer[9*i + 4]+1)* kHeight/2;
            var bz = (triBuffer[9*i + 5]+1) * kHeight/2;
            var cx = (triBuffer[9*i + 6]+1) * kWidth/2;
            var cy = (triBuffer[9*i + 7]+1) * kHeight/2;
            var cz = (triBuffer[9*i + 8]+1) * kHeight/2;
            rasterFlatTriangleBarycentric(  framebuffer,
                                            ax, ay, az,
                                            bx, by, bz,
                                            cx, cy, cz,
                                            [
                                              255* Math.random(),
                                              255* Math.random(),
                                              255* Math.random(),
                                              255
                                            ]);
          }
          framebuffer.flush();

          console.log("Done drawing.");
        }
      };
      r.send();
    </script>
  </body>
</html>
